(function () {
  function q(sel, root) { return (root || document).querySelector(sel); }
  function getTitle() {
    var og = document.querySelector('meta[property="og:title"]');
    return (og && og.getAttribute('content')) || document.title || '';
  }
  function getUrl() {
    return window.location.href;
  }
  function showToast(root, msg) {
    var t = q('[data-share-toast]', root);
    if (!t) return;
    t.textContent = msg;
    t.classList.add('show');
    clearTimeout(t.__hideTimer);
    t.__hideTimer = setTimeout(function(){ t.classList.remove('show'); }, 1800);
  }
  function copy(text) {
    if (navigator.clipboard && navigator.clipboard.writeText) {
      return navigator.clipboard.writeText(text).then(function(){ return true; }).catch(function(){ return false; });
    }
    return new Promise(function(resolve){
      try {
        var ta = document.createElement('textarea');
        ta.value = text;
        ta.setAttribute('readonly', '');
        ta.style.position = 'fixed';
        ta.style.left = '-9999px';
        document.body.appendChild(ta);
        ta.select();
        var ok = document.execCommand('copy');
        document.body.removeChild(ta);
        resolve(!!ok);
      } catch(e) { resolve(false); }
    });
  }
  function initBlock(root) {
    var url = getUrl();
    var title = getTitle();
    var btnNative = q('[data-share="native"]', root);
    var btnCopy = q('[data-share="copy"]', root);
    var wa = q('[data-share="wa"]', root);
    var fb = q('[data-share="fb"]', root);
    var x = q('[data-share="x"]', root);
    if (wa) wa.href = 'https://wa.me/?text=' + encodeURIComponent(title + '\n' + url);
    if (fb) fb.href = 'https://www.facebook.com/dibawahnaunganiksass' + encodeURIComponent(url);
    if (x) x.href = 'https://twitter.com/intent/tweet?url=' + encodeURIComponent(url) + '&text=' + encodeURIComponent(title);
    if (btnNative) {
      if (!navigator.share) {
        btnNative.style.display = 'none';
      } else {
        btnNative.addEventListener('click', function(){
          navigator.share({ title: title, text: title, url: url }).catch(function(){});
        });
      }
    }
    if (btnCopy) {
      btnCopy.addEventListener('click', function(){
        copy(url).then(function(ok){
          showToast(root, ok ? 'Link berhasil disalin ✅' : 'Gagal menyalin link ❌');
        });
      });
    }
  }
  document.addEventListener('DOMContentLoaded', function(){
    var blocks = document.querySelectorAll('[data-share-block]');
    for (var i=0;i<blocks.length;i++) initBlock(blocks[i]);
  });
})();